<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Statistics for Developers</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <header>
        <div class="home-image"><a href="../index.html"><img src="../images/chart.png" width="45" height="45" alt="Home"></a></div>
        <h1 class="logo">Practice Homework 8 </h1>
    </header>

    <main class="grid-layout-practice">
        <!-- Left Sidebar with navigation menu -->
        <nav class="left-sidebar">
            <ul>
                <li><a href="../hw8/theoryhw8.html">Theory</a></li>
                <li><a href="../hw8/practicehw8.html">Practice</a></li>
            </ul>
        </nav>

        <!-- Main Content Area -->
        <section class="main-content">

            <h1>Caesar Cipher and Frequency Analysis</h1>

            <h2>Input Text</h2>

            <textarea id="inputText" placeholder="Paste your text here..."></textarea>
            <button id="generateChart" class="my-button">Generate Letter Frequency</button>
            <canvas id="frequencyChart"></canvas>
            <h2>Caesar Cipher</h2>
            <p id="encryptionOutput"></p>
            <p id="decryptionOutput"></p>
          
            <h2>Numeric Encoding</h2>
            <p><strong>Formula:</strong> \( N^k \mod P \) </p>
            <label for="nvalue">Enter N: </label>
            <input type="number" id="nvalue" min="1" max="50" value="10">
            <label for="pvalue">Enter P: </label>
            <input type="number" id="pvalue" min="1" max="50" value="37">
            <button id="encodeText" class="my-button">Encode</button>
            <p id="numericEncodingOutput"></p>
            <canvas id="numericChart"></canvas>
          
            <h2>Shannon Entropy</h2>
            <p id="entropyOutput"></p>
            
        </section>
    </main>
    <script>
        const alphabet = "abcdefghijklmnopqrstuvwxyz";
    
        // Utility: Count letter frequencies
        function countFrequencies(text) {
          const frequencies = {};
          for (let char of text.toLowerCase()) {
            if (alphabet.includes(char)) {
              frequencies[char] = (frequencies[char] || 0) + 1;
            }
          }
          return frequencies;
        }
    
        // Utility: Caesar cipher encryption
        function caesarCipher(text, shift) {
          return text
            .split("")
            .map((char) => {
              const isUpperCase = char === char.toUpperCase();
              char = char.toLowerCase();
              if (alphabet.includes(char)) {
                const shiftedIndex = (alphabet.indexOf(char) + shift) % alphabet.length;
                const shiftedChar = alphabet[shiftedIndex];
                return isUpperCase ? shiftedChar.toUpperCase() : shiftedChar;
              }
              return char; // Non-alphabetical characters remain unchanged
            })
            .join("");
        }
    
        // Utility: Frequency analysis decryption
        function decryptUsingFrequencyAnalysis(encryptedText) {
          const encryptedFrequencies = countFrequencies(encryptedText);
          const sortedEncrypted = Object.entries(encryptedFrequencies).sort((a, b) => b[1] - a[1]);
          const englishFreqOrder = "etaoinshrdlcumwfgypbvkjxqz"; // Approximate English frequency order
          const potentialShift = alphabet.indexOf(sortedEncrypted[0][0]) - alphabet.indexOf(englishFreqOrder[0]);
          return caesarCipher(encryptedText, (alphabet.length - potentialShift) % alphabet.length);
        }
    
        // Part 2: Numeric encoding
        function numericEncoding(text, n, p) {
          return text
            .toLowerCase()
            .split("")
            .map((char) => {
              if (alphabet.includes(char)) {
                const k = alphabet.indexOf(char); // Numeric representation (A=0, ..., Z=25)
                return Math.pow(n, k) % p; // N^k mod P
              }
              return null; // Non-alphabetical characters are ignored in encoding
            })
            .filter((val) => val !== null); // Remove nulls
        }
    
        // Calculate Shannon entropy
        function calculateEntropy(distribution) {
          const total = distribution.reduce((sum, count) => sum + count, 0);
          return -distribution
            .filter((count) => count > 0) // Exclude zeros
            .map((count) => count / total) // Convert counts to probabilities
            .reduce((entropy, prob) => entropy + prob * Math.log2(prob), 0); // Shannon entropy formula
        }
    
        // Generate Chart.js chart
        function generateChart(canvasId, labels, data, chartTitle) {
          const ctx = document.getElementById(canvasId).getContext("2d");
          new Chart(ctx, {
            type: "bar",
            data: {
              labels: labels,
              datasets: [{
                label: chartTitle,
                data: data,
                backgroundColor: "rgba(75, 192, 192, 0.2)",
                borderColor: "rgba(75, 192, 192, 1)",
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        }
    
        // Main event listener
        document.getElementById("generateChart").addEventListener("click", () => {main()});
        document.getElementById("encodeText").addEventListener("click", () => {
            const encodedValues = numericEncoding(document.getElementById("inputText").value, document.getElementById("nvalue").value, document.getElementById("pvalue").value);
            document.getElementById("numericEncodingOutput").innerHTML = `
                <strong>Encoded Values:</strong> ${encodedValues.join(", ")}
            `;
        
            // Step 5: Numeric encoding distribution
            const encodingFrequencies = encodedValues.reduce((acc, val) => {
                acc[val] = (acc[val] || 0) + 1;
                return acc;
            }, {});
            const encodingLabels = Object.keys(encodingFrequencies).map(Number).sort((a, b) => a - b);
            const encodingData = encodingLabels.map((val) => encodingFrequencies[val]);
            if (numericChart !== null) {
                numericChart.destroy();
            }
            generateChart("numericChart", encodingLabels, encodingData, "Numeric Encoding Distribution");
        
            // Step 6: Shannon entropy
            const entropy = calculateEntropy(encodingData);
            document.getElementById("entropyOutput").innerHTML = `
                <strong>Shannon Entropy:</strong> ${entropy.toFixed(4)}
            `;
        });

        function main(){
            const inputText = document.getElementById("inputText").value;
    
            // Step 1: Letter frequency distribution
            const frequencies = countFrequencies(inputText);
            const frequencyLabels = Object.keys(frequencies).sort();
            const frequencyData = frequencyLabels.map((letter) => frequencies[letter]);
            generateChart("frequencyChart", frequencyLabels, frequencyData, "Letter Frequency");
        
            // Step 2: Caesar cipher encryption
            const randomShift = Math.floor(Math.random() * 25) + 1;
            const encryptedText = caesarCipher(inputText, randomShift);
            document.getElementById("encryptionOutput").innerHTML = `
                <strong>Encrypted Text (Shift: ${randomShift}):</strong> ${encryptedText}
            `;
        
            // Step 3: Frequency analysis decryption
            const decryptedText = decryptUsingFrequencyAnalysis(encryptedText);
            document.getElementById("decryptionOutput").innerHTML = `
                <strong>Decrypted Text:</strong> ${decryptedText}
            `;
        
            // Step 4: Numeric encoding
            const n = parseInt(document.getElementById('nvalue').value);
            const p = parseInt(document.getElementById('pvalue').value);;
            const encodedValues = numericEncoding(inputText, n, p);
            document.getElementById("numericEncodingOutput").innerHTML = `
                <strong>Encoded Values:</strong> ${encodedValues.join(", ")}
            `;
        
            // Step 5: Numeric encoding distribution
            const encodingFrequencies = encodedValues.reduce((acc, val) => {
                acc[val] = (acc[val] || 0) + 1;
                return acc;
            }, {});
            const encodingLabels = Object.keys(encodingFrequencies).map(Number).sort((a, b) => a - b);
            const encodingData = encodingLabels.map((val) => encodingFrequencies[val]);
            generateChart("numericChart", encodingLabels, encodingData, "Numeric Encoding Distribution");
        
            // Step 6: Shannon entropy
            const entropy = calculateEntropy(encodingData);
            document.getElementById("entropyOutput").innerHTML = `
                <strong>Shannon Entropy:</strong> ${entropy.toFixed(4)}
            `;
        }
      </script>
        
    </div>
</body>
</html>
